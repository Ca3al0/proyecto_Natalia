{% extends "common/base.html" %}

{% block title %}Seguimiento de Pedido{% endblock %}

{% block extra_css %}
<style>
:root {
  --celeste-claro: #e7fcff;
  --celeste: #d1faff;
  --azul-gris: #d1faffe; 
  --verde: #57a773;
  --verde-oscuro: #157145;
}

.tracking-container {
  display: flex;
  justify-content: center;
  padding: 2rem 1rem;
}

.tracking-panel {
  background: white; /* se mantiene igual */
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  padding: 2rem;
  width: 100%;
  max-width: 600px;
  position: relative;
  z-index: 1;
}

.tracking-panel h2 {
  margin-top: 0;
  color: var(--verde-oscuro); /* cambiamos del azul oscuro a verde oscuro */
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.tracking-data-block {
  margin: 1.5rem 0;
  border-top: 1px solid #eee;
  padding-top: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.tracking-product-img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.tracking-info p {
  margin: 0.3rem 0;
  font-size: 0.95rem;
}

/* === Barra de progreso === */
.tracking-progress-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  margin: 2rem auto;
}

.tracking-progress-bar::before {
  content: "";
  position: absolute;
  top: 16px;
  left: 8%;
  width: 84%;
  height: 5px;
  background: #ddd; /* se mantiene igual */
  z-index: 0;
}

.tracking-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 1;
  width: 25%;
}

.tracking-step .circle {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #ccc;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  color: white;
  margin-bottom: 0.5rem;
  transition: background 0.3s;
}

.tracking-step.active .circle {
  background: var(--verde); /* c√≠rculo activo en verde */
}

.tracking-step p {
  font-size: 0.85rem;
  margin: 0;
  text-align: center;
}

.tracking-status-message {
  text-align: center;
  font-weight: bold;
  font-size: 1.1rem;
  margin-top: 1rem;
  color: var(--verde-oscuro); 
}

@media (max-width: 576px) {
  .tracking-panel {
    padding: 1.5rem;
  }
  .tracking-step p {
    font-size: 0.75rem;
  }
}
</style>
{% endblock %}


{% block navbar %}
  {% include "common/partials/navbar_cliente.html" %}
{% endblock %}

{% block content %}
<div class="tracking-container">
  <div class="tracking-panel">
    <h2>Actualizaciones sobre tu pedido</h2>

    <div class="tracking-data-block">
      <img src="{% if pedido.ImagenProducto %}{{ url_for('static', filename=pedido.ImagenProducto) }}{% else %}{{ url_for('static', filename='img/no-image.jpg') }}{% endif %}" 
           alt="Producto pedido" class="tracking-product-img">

      <div class="tracking-info">
        <p><strong>ID Pedido:</strong> #{{ pedido.ID_Pedido }}</p>
        <p><strong>Transportista:</strong> {{ pedido.TransportistaNombre }}</p>
      </div>
    </div>

    {% set estados = ['en proceso', 'en despacho', 'en ruta', 'entregado'] %}
    {% set estado_actual_index = estados.index(pedido.Estado) if pedido.Estado in estados else -1 %}

    <div class="tracking-progress-bar" id="barraProgresoCliente">
      {% for i in range(4) %}
        <div class="tracking-step {% if estado_actual_index >= i %}active{% endif %}">
          <div class="circle">{{ i + 1 }}</div>
          {% set texto_paso = estados[i] | replace('_',' ') | capitalize %}
          {% if texto_paso == 'En ruta' %}{% set texto_paso = 'En Ruta' %}
          {% elif texto_paso == 'En despacho' %}{% set texto_paso = 'En Despacho' %}
          {% elif texto_paso == 'En proceso' %}{% set texto_paso = 'En Proceso' %}
          {% elif texto_paso == 'Entregado' %}{% set texto_paso = 'Entregado' %}
          {% endif %}
          <p>{{ texto_paso }}</p>
        </div>
      {% endfor %}
    </div>

    <div class="tracking-status-message" id="mensajeCliente">
      Estado actual:
      {% if pedido.Estado == 'en proceso' %} En proceso
      {% elif pedido.Estado == 'en despacho' %} En despacho
      {% elif pedido.Estado == 'en ruta' %} En ruta de entrega
      {% elif pedido.Estado == 'entregado' %}Entregado
      {% else %}Pendiente{% endif %}
    </div>
  </div>
</div>
{% endblock %}
