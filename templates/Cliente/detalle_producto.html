{% extends "common/base.html" %}

{% block title %}Seguimiento de Pedido{% endblock %}

{% block extra_css %}
<style>

  body {
    padding-top: 90px !important; /* Compensar navbar fijo */
    background: #f9f9f9;
    color: #333;
    font-family: 'Roboto', sans-serif;
  }

  .tracking-container {
    display: flex;
    justify-content: center;
    padding: 2rem 1rem;
  }

  .tracking-panel {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    padding: 2rem;
    width: 100%;
    max-width: 600px;
    position: relative;
    z-index: 1;
  }

  .tracking-panel h2 {
    margin-top: 0;
    color: #004aad;
    font-size: 1.6rem;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* === Bloque de informaci√≥n con imagen === */
  .tracking-data-block {
    margin: 1.5rem 0;
    border-top: 1px solid #eee;
    padding-top: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .tracking-product-img {
    width: 90px;
    height: 90px;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background-color: #fff;
  }

  .tracking-info p {
    margin: 0.3rem 0;
    font-size: 0.95rem;
  }

  /* === Barra de progreso === */
  .tracking-progress-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    margin: 2rem auto;
  }

  .tracking-progress-bar::before {
    content: "";
    position: absolute;
    top: 16px;
    left: 8%;
    width: 84%;
    height: 5px;
    background: #ddd;
    z-index: 0;
  }

  .tracking-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
    width: 25%;
  }

  .tracking-step .circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    color: white;
    margin-bottom: 0.5rem;
    transition: background 0.3s;
  }

  .tracking-step.active .circle {
    background: #004aad;
  }

  .tracking-step p {
    font-size: 0.85rem;
    margin: 0;
    text-align: center;
  }

  /* === Estado actual === */
  .tracking-status-message {
    text-align: center;
    font-weight: bold;
    font-size: 1.1rem;
    margin-top: 1rem;
  }

  @media (max-width: 576px) {
    .tracking-panel {
      padding: 1.5rem;
    }
    .tracking-step p {
      font-size: 0.75rem;
    }
    .tracking-product-img {
      width: 70px;
      height: 70px;
    }
  }
</style>
{% endblock %}

{% block navbar %}
  {% include "common/partials/navbar_cliente.html" %}
{% endblock %}

{% block content %}
<div class="tracking-container">
  <div class="tracking-panel">
    <h2>üë§ Vista del Cliente</h2>

    <div class="tracking-data-block">
      <img 
        src="{{ url_for('static', filename=pedido.ImagenProducto) if pedido.ImagenProducto else url_for('static', filename='img/salacarrusel.png') }}" 
        alt="Imagen de {{ pedido.NombreProducto }}" 
        class="tracking-product-img">

      <div class="tracking-info">
        <p><strong>Producto:</strong> {{ pedido.NombreProducto }}</p>
        <p><strong>ID Pedido:</strong> #{{ pedido.ID_Pedido }}</p>
        <p><strong>Transportista:</strong> {{ pedido.TransportistaNombre }}</p>
      </div>
    </div>

    {% set estados = ['en proceso', 'en despacho', 'en ruta', 'entregado'] %}
    {% set estado_actual_index = estados.index(pedido.Estado) if pedido.Estado in estados else -1 %}

    <div class="tracking-progress-bar" id="barraProgresoCliente">
      {% for i in range(4) %}
        <div class="tracking-step {% if estado_actual_index >= i %}active{% endif %}">
          <div class="circle">{{ i + 1 }}</div>
          {% set texto_paso = estados[i] | replace('_',' ') | capitalize %}
          {% if texto_paso == 'En ruta' %}{% set texto_paso = 'En Ruta' %}
          {% elif texto_paso == 'En despacho' %}{% set texto_paso = 'En Despacho' %}
          {% elif texto_paso == 'En proceso' %}{% set texto_paso = 'En Proceso' %}
          {% elif texto_paso == 'Entregado' %}{% set texto_paso = 'Entregado' %}
          {% endif %}
          <p>{{ texto_paso }}</p>
        </div>
      {% endfor %}
    </div>

    <div class="tracking-status-message" id="mensajeCliente">
      Estado actual:
      {% if pedido.Estado == 'en proceso' %}üõ†Ô∏è En proceso
      {% elif pedido.Estado == 'en despacho' %}üì¶ En despacho
      {% elif pedido.Estado == 'en ruta' %}üöö En ruta de entrega
      {% elif pedido.Estado == 'entregado' %}‚úÖ Entregado
      {% else %}Pendiente{% endif %}
    </div>
  </div>
</div>
{% endblock %}
