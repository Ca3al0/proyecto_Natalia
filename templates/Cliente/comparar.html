{% extends "common/base.html" %}

{% block navbar %}
{% include "common/partials/navbar_cliente.html" %}
{% endblock %}

{% block content %}

<style>
/* Tarjetas de productos */
.card {
  border-radius: 15px;
  transition: transform 0.3s, box-shadow 0.3s;
  cursor: pointer;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

/* Botones de selección */
.btn-select-compare.active {
  background-color: white;
  color: #28a745;
  border: 2px solid #28a745;
  font-weight: bold;
}

/* Precio y color */
.precio {
  font-size: 1.1rem;
  font-weight: 600;
  color: #28a745;
}
.color {
  font-size: 0.95rem;
  color: #6c757d;
}

/* Botón fijo de comparar */
#btn-comparar {
  background-color: #28a745;
  color: white;
  font-weight: bold;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  transition: transform 0.2s;
}
#btn-comparar:hover {
  transform: scale(1.05);
  background-color: #218838;
}

/* Tabla comparativa */
#tabla-comparativa th, #tabla-comparativa td {
  vertical-align: middle;
}
#tabla-comparativa img {
  border-radius: 8px;
}
#comparativa {
  animation: fadeIn 0.5s ease-in-out;
}
@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity:1;}
}
</style>

<style>
/* Tabla comparativa general */
#comparativa {
  margin-top: 2rem;
}

#tabla-comparativa {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  font-family: 'Segoe UI', sans-serif;
}

/* Encabezado */
#tabla-comparativa thead {
  background-color: #28a745; /* Verde */
  color: white;
}

#tabla-comparativa thead th {
  text-align: center;
  font-size: 1rem;
  font-weight: 600;
  padding: 12px 8px;
}

/* Celdas */
#tabla-comparativa td {
  background-color: #f9f9f9;
  padding: 12px 8px;
  font-size: 0.95rem;
  vertical-align: middle;
}

/* Primera columna */
#tabla-comparativa td:first-child {
  font-weight: 600;
  color: #333;
  background-color: #e9f7ef;
}

/* Imágenes dentro de la tabla */
#tabla-comparativa td img {
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

/* Hover sobre filas */
#tabla-comparativa tbody tr:hover td {
  background-color: #f1fff4;
  transition: background-color 0.3s;
}

/* Responsive */
@media (max-width: 768px) {
  #tabla-comparativa thead {
    font-size: 0.9rem;
  }
  #tabla-comparativa td {
    font-size: 0.85rem;
    padding: 10px 5px;
  }
  #tabla-comparativa td img {
    height: 80px;
  }
}
</style>



<div class="container mt-5">
  <h2 class="mb-4 text-center text-success"><b>Comparar Productos</b></h2>


  <div class="row" id="productos-container">
    {% for producto in productos %}
    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm text-center" data-id="{{ producto.ID_Producto }}">
        <img src="{{ url_for('static', filename=producto.ImagenPrincipal or 'img/catalogo.png') }}" 
             class="card-img-top" style="height:200px; object-fit:cover; border-radius:10px 10px 0 0;">
        <div class="card-body">
          <h5 class="card-title">{{ producto.NombreProducto }}</h5>
          <p class="card-text precio">${{ '%.2f'|format(producto.PrecioUnidad) }}</p>
          {% if producto.Color %}<p class="card-text color">Color: {{ producto.Color }}</p>{% endif %}
          <button class="btn btn-success rounded-pill btn-select-compare px-4 py-2" data-id="{{ producto.ID_Producto }}">
            Seleccionar
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  
  <div id="comparativa" class="mt-5" style="display:none;">
    <h3 class="text-center mb-4 text-success"><b>Comparacion</b></h3>
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle" id="tabla-comparativa" style="background:#f9f9f9; border-radius:10px; overflow:hidden;">
        <thead class="bg-success text-white">
          <tr>
            <th>Característica</th>
            <th>Producto 1</th>
            <th>Producto 2</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Imagen</strong></td>
            <td id="img1"></td>
            <td id="img2"></td>
          </tr>
          <tr>
            <td><strong>Nombre</strong></td>
            <td id="nombre1"></td>
            <td id="nombre2"></td>
          </tr>
          <tr>
            <td><strong>Precio</strong></td>
            <td id="precio1"></td>
            <td id="precio2"></td>
          </tr>
          <tr>
            <td><strong>Color</strong></td>
            <td id="color1"></td>
            <td id="color2"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


<a href="#" id="btn-comparar" 
   class="btn btn-success shadow-lg position-fixed rounded-pill px-4 py-2"
   style="bottom: 30px; right: 30px; z-index: 1050; display:none;">
   Comparar Productos
</a>

<div class="modal fade" id="modalLimite" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-success">
      <div class="modal-body text-center py-4" style="font-size:1.1rem;">
        <div>Solo puedes seleccionar 2 productos para comparar</div>
        <button type="button" class="btn btn-success mt-3 px-4 py-2 rounded-pill" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  let comparar = [];
  const btnComparar = document.getElementById('btn-comparar');
  const comparativa = document.getElementById('comparativa');
  const modalLimite = new bootstrap.Modal(document.getElementById('modalLimite'));

  function actualizarBotones() {
    document.querySelectorAll('.btn-select-compare').forEach(btn => {
      const id = btn.getAttribute('data-id');
      if(comparar.includes(id)){
        btn.classList.add('active');
        btn.classList.remove('btn-success');
        btn.classList.add('btn-outline-success');
        btn.textContent = 'Seleccionado';
      } else {
        btn.classList.remove('active');
        btn.classList.remove('btn-outline-success');
        btn.classList.add('btn-success');
        btn.textContent = 'Seleccionar';
      }
    });
    btnComparar.style.display = comparar.length > 0 ? 'inline-block' : 'none';
  }

  document.querySelectorAll('.btn-select-compare').forEach(btn => {
    btn.addEventListener('click', function() {
      const id = this.getAttribute('data-id');
      if(comparar.includes(id)){
        comparar = comparar.filter(x => x !== id);
      } else {
        if(comparar.length >= 2){
          modalLimite.show();
          return;
        }
        comparar.push(id);
      }
      actualizarBotones();
    });
  });

  btnComparar.addEventListener('click', function(e){
    e.preventDefault();
    if(comparar.length < 2){
      modalLimite.show();
      return;
    }

    comparar.forEach((id, index) => {
      const prodCard = document.querySelector(`.card[data-id='${id}']`);
      const img = prodCard.querySelector('img').src;
      const nombre = prodCard.querySelector('.card-title').textContent;
      const precio = prodCard.querySelector('.precio').textContent;
      const color = prodCard.querySelector('.color') ? prodCard.querySelector('.color').textContent.replace('Color: ','') : '-';

      document.getElementById('img'+(index+1)).innerHTML = `<img src="${img}" style="height:100px; object-fit:cover; border-radius:8px;">`;
      document.getElementById('nombre'+(index+1)).textContent = nombre;
      document.getElementById('precio'+(index+1)).textContent = precio;
      document.getElementById('color'+(index+1)).textContent = color;
    });

    comparativa.style.display = 'block';
    window.scrollTo({ top: comparativa.offsetTop - 20, behavior: 'smooth' });
  });
});
</script>
{% endblock %}
