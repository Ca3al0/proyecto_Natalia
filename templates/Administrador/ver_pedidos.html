{% extends "common/base.html" %}

{% block navbar %}
  {% include "common/partials/navbar_admin.html" %}
  {% include "common/partials/navbar_secundario3.html" %}
{% endblock %}

{% block content %}

<!-- Estilos -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} flash-small d-flex align-items-center mt-3" role="alert">
        {% if category == 'success' %}
          <i class="bi bi-check-circle-fill me-2"></i>
        {% elif category == 'danger' %}
          <i class="bi bi-x-circle-fill me-2"></i>
        {% elif category == 'warning' %}
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {% elif category == 'info' %}
          <i class="bi bi-info-circle-fill me-2"></i>
        {% endif %}
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="container mt-4">
  <h2 class="mb-4">ðŸ“¦ Todos los Pedidos</h2>

  {% if pedidos %}
    <div class="row">
      {% for pedido in pedidos %}
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Pedido #{{ pedido.get('id_pedido', 'N/A') }}</h5>
              <p><strong>Estado:</strong> {{ pedido.get('Estado', 'Desconocido') }}</p>
              <p><strong>Cliente:</strong> {{ pedido.get('NombreComprador', 'Desconocido') }}</p>
              <p><strong>TelÃ©fono:</strong> {{ pedido.get('TelefonoUsuario', 'Desconocido') }}</p>
              <p><strong>DirecciÃ³n:</strong> {{ pedido.get('Direccion', 'Desconocida') }}</p>

              <h6 class="mt-3">Productos:</h6>
              <ul>
                {% for producto in pedido.get('Productos', []) %}
                  <li>{{ producto.get('Nombre', 'Producto') }} - Cantidad: {{ producto.get('Cantidad', 0) }}</li>
                {% endfor %}
              </ul>

              <form method="POST" action="{{ url_for('admin.asignar_transportista', id_pedido=pedido.get('id_pedido')) }}">
                <div class="mb-3">
                  <label for="transportista_{{ pedido.get('id_pedido') }}" class="form-label">Asignar Transportista:</label>
                  <select name="transportista_id" id="transportista_{{ pedido.get('id_pedido') }}" class="form-select" required>
                    <option value="" disabled selected>Selecciona un transportista</option>
                    {% for usuario in usuarios_transportistas %}
                      <option value="{{ usuario.get('ID_Usuario') }}">{{ usuario.get('Nombre') }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="mb-3">
                  <label for="hora_llegada_{{ pedido.get('id_pedido') }}" class="form-label">Hora de llegada:</label>
                  <input type="datetime-local" name="hora_llegada" id="hora_llegada_{{ pedido.get('id_pedido') }}" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-primary">Asignar</button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No hay pedidos registrados.</p>
  {% endif %}
</div>

{% endblock %}
