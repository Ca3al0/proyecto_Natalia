<!-- PANEL TRANSPORTISTA -->
<div class="panel">
  <h2>ğŸšš Panel del Transportista</h2>

  <div class="data-block">
    <p><strong>ID Pedido:</strong> #{{ pedido.ID_Pedido }}</p>
    <p><strong>Cliente:</strong> {{ pedido.usuario.Nombre }} {{ pedido.usuario.Apellido }}</p>
    <p><strong>DirecciÃ³n:</strong> {{ pedido.usuario.Direccion }}</p>
    <p><strong>ArtÃ­culo:</strong> {{ pedido.NomArticulo }}</p>
  </div>

  <form method="POST" onsubmit="return validarAvance();">
    <label for="estado">Actualizar estado del pedido:</label>
    <select id="estado" name="estado" class="form-select">
      <option value="pendiente" {% if pedido.Estado == 'pendiente' %}selected{% endif %}>ğŸ•“ Pendiente</option>
      <option value="en proceso" {% if pedido.Estado == 'en proceso' %}selected{% endif %}>ğŸ› ï¸ En proceso</option>
      <option value="en reparto" {% if pedido.Estado == 'en reparto' %}selected{% endif %}>ğŸšš En reparto</option>
      <option value="entregado" {% if pedido.Estado == 'entregado' %}selected{% endif %}>âœ… Entregado</option>
    </select>

    <button type="submit" class="btn btn-success mt-2">Actualizar estado</button>
  </form>

  <div class="info">
    Cambia el estado actual solo para avanzar en el proceso. No se puede volver atrÃ¡s.
  </div>
</div>

<script>
  // Estado actual del pedido (inyectado desde Jinja)
  const estadoActual = "{{ pedido.Estado }}";

  // Orden lÃ³gico de los estados
  const ordenEstados = ["pendiente", "en proceso", "en reparto", "entregado"];

  function validarAvance() {
    const nuevoEstado = document.getElementById("estado").value;

    const indiceActual = ordenEstados.indexOf(estadoActual);
    const indiceNuevo = ordenEstados.indexOf(nuevoEstado);

    if (indiceNuevo < indiceActual) {
      alert("âš ï¸ No puedes regresar a un estado anterior.");
      return false; // bloquea el envÃ­o del formulario
    }

    return true; // permite avanzar
  }
</script>
