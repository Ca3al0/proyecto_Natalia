{% extends "common/base.html" %}

{% block content %}
<style>
  .detalle-empleado {
      background: #f9f9f9;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
  }

  h2 { color: #28a745; font-weight: bold; margin-bottom: 1.5rem; }
  h4 { color: #157145; margin-top: 2rem; margin-bottom: 1rem; }

  ul.info-general { list-style: none; padding-left: 0; margin-bottom: 2rem; }
  ul.info-general li { background: #d1faff; padding: 0.6rem 1rem; margin-bottom: 0.5rem; border-radius: 10px; font-weight: 500; }

  table.table { width: 100%; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-top: 1rem; }
  table.table th { background: #28a745; color: white; text-align: center; padding: 0.5rem; }
  table.table td { text-align: center; vertical-align: middle; padding: 0.5rem; }

  .btn-secondary, .btn-primary { margin-top: 1rem; padding: 0.6rem 1.2rem; border-radius: 50px; font-weight: 600; transition: 0.3s; }
  .btn-secondary:hover { background: #157145; color: white; transform: scale(1.05); }
  .btn-primary:hover { background: #28a745; color: white; transform: scale(1.05); }

  .resumen-mes { background: #e6f7f1; padding: 1rem; border-radius: 10px; margin-top: 1rem; }
  .resumen-mes p { margin-bottom: 0.5rem; font-weight: 500; font-size: 1.1rem; }

  input[type=number] { width: 80px; padding: 0.3rem; border-radius: 5px; border: 1px solid #ccc; text-align: center; }
</style>

<div class="detalle-empleado">
    <h2>Detalle de {{ empleado.Nombre }} {{ empleado.Apellido }}</h2>

    <h4>Información General</h4>
    <ul class="info-general">
        <li><strong>Correo:</strong> {{ empleado.Correo }}</li>
        <li><strong>Teléfono:</strong> {{ empleado.Telefono }}</li>
        <li><strong>Rol:</strong> {{ empleado.Rol }}</li>
    </ul>

    <h4>Pedidos realizados</h4>
    <table class="table">
        <thead>
            <tr>
                <th>ID Pedido</th>
                <th>Estado</th>
                <th>Hora Llegada</th>
                <th>Fecha Entrega</th>
                <th>Productos</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
                <tr>
                    <td>{{ pedido.ID_Pedido }}</td>
                    <td>{{ pedido.Estado }}</td>
                    <td>{{ pedido.HoraLlegada.strftime("%Y-%m-%d %H:%M") if pedido.HoraLlegada else '-' }}</td>
                    <td>{{ pedido.FechaEntrega.strftime("%Y-%m-%d %H:%M") if pedido.FechaEntrega else '-' }}</td>
                    <td>
                        <ul style="list-style:none; padding-left:0;">
                            {% for detalle in pedido.detalles_pedido %}
                                <li>{{ detalle.Cantidad }} x {{ detalle.producto.NombreProducto if detalle.producto else 'Producto eliminado' }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4>Horas trabajadas</h4>
    <p><strong>Total Horas:</strong> 48 h</p> 
    <p><strong>Horas Extra:</strong> {{ total_horas_extra }} h</p>

    <h4>Ingresar horas diurnas y nocturnas</h4>
    <form method="POST" action="{{ url_for('admin.detalle_empleado', id_empleado=empleado.ID_Usuario) }}">
        <label>Horas Diurnas: <input type="number" name="horas_diurnas" value="{{ horas_diurnas or 0 }}" min="0"></label>
        &nbsp;&nbsp;
        <label>Horas Nocturnas: <input type="number" name="horas_nocturnas" value="{{ horas_nocturnas or 0 }}" min="0"></label>
        &nbsp;&nbsp;
        <button type="submit" class="btn btn-primary">Actualizar</button>
    </form>

    <h4>Pagos y Resumen Mensual</h4>
    <div class="resumen-mes">
        {% set pago_base = 1423500 %}
        {% set auxilio_transporte = 200000 %}
        {% set valor_hora_extra = 15000 %}
        {% set pago_hora_diurna = 8088 %}
        {% set pago_hora_nocturna = 11323 %}

        {% set total_diurnas = (horas_diurnas or 0) * pago_hora_diurna %}
        {% set total_nocturnas = (horas_nocturnas or 0) * pago_hora_nocturna %}
        {% set total_horas_extra_valor = (total_horas_extra or 0) * valor_hora_extra %}
        {% set total_mes = pago_base + auxilio_transporte + total_horas_extra_valor + total_diurnas + total_nocturnas %}

        <p>Pago base del mes: ${{ "{:,.0f}".format(pago_base) }} COP</p>
        <p>Auxilio de transporte: ${{ "{:,.0f}".format(auxilio_transporte) }} COP</p>
        <p>Pago por horas extra: ${{ "{:,.0f}".format(total_horas_extra_valor) }} COP</p>
        <p>Pago por horas diurnas: ${{ "{:,.0f}".format(total_diurnas) }} COP</p>
        <p>Pago por horas nocturnas: ${{ "{:,.0f}".format(total_nocturnas) }} COP</p>
        <hr>
        <p><strong>Total estimado a recibir este mes: ${{ "{:,.0f}".format(total_mes) }} COP</strong></p>
    </div>

    <a href="{{ url_for('admin.lista_empleados') }}" class="btn btn-secondary">Volver</a>
</div>
{% endblock %}
